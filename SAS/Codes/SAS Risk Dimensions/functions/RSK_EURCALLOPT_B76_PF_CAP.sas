function RSK_EURCALLOPT_B76_PF_CAP(ForwardPrice, Strike, RiskFreeRate, TimeToExpiration, Volatility, CapVolatility, Cap_premium)
          label="European call option pricing by Black (1976)"
          kind="European option analytic pricing";
	/**************************************************************************/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	/* ERROR CHECKING
	/**************************************************************************/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	if TimeToExpiration lt 0 then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		return(0);
 
	/* Initialize the return missing flag to zero
	 If we find an error in one of the inputs, we will return missing */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	/* Set the function name for error reporting */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	ReturnMissingFlg = 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	Fname = 'rsk_eurcallopt_b76_pf_cap';          
 
	/* Make sure some inputs are positive or nonnegative*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	/* Negative and missing values for those inputs may cause problems
	 if input into another function (e.g. the logarithm function) */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	ReturnMissingFlg = rsk_check_num_missing_pf( RiskFreeRate, Fname, '3', 'RiskFreeRate', ReturnMissingFlg );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	ReturnMissingFlg = rsk_check_num_missing_pf( TimeToExpiration, Fname, '4', 'TimeToExpiration', ReturnMissingFlg );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	ReturnMissingFlg = rsk_check_nonpositive_pf( ForwardPrice, Fname, '1', 'ForwardPrice', ReturnMissingFlg );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	ReturnMissingFlg = rsk_check_nonpositive_pf( Strike, Fname, '2', 'Strike', ReturnMissingFlg );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	ReturnMissingFlg = rsk_check_nonpositive_pf( Volatility, Fname, '5', 'Volatility', ReturnMissingFlg );
	ReturnMissingFlg = rsk_check_nonpositive_pf( CapVolatility, Fname, '6', 'CapVolatility', ReturnMissingFlg );
	ReturnMissingFlg = rsk_check_nonpositive_pf( Cap_premium, Fname, '7', 'Cap_premium', ReturnMissingFlg ); 
 
	/* Return missing, if errors are found */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	if ReturnMissingFlg eq 1 then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		return(.);                  
 
	/************************************************************/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	/* RESUME STANDARD PRICING
	/************************************************************/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	IF TimeToExpiration eq 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		return (max(min(ForwardPrice-Cap_premium,ForwardPrice-Strike),0));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	g = Volatility*sqrt(TimeToExpiration);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	d1 = log(ForwardPrice / Strike) /g + 0.5 * g;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	d2 = d1 - g;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	OptionPrice = exp(- RiskFreeRate * TimeToExpiration) * (ForwardPrice * probnorm(d1) - Strike * probnorm(d2));

	g = CapVolatility*sqrt(TimeToExpiration);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	d1 = log(ForwardPrice / Cap_premium) /g + 0.5 * g;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	d2 = d1 - g;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	OptionPrice_cap = exp(- RiskFreeRate * TimeToExpiration) * (ForwardPrice * probnorm(d1) - Cap_premium * probnorm(d2));
	 
	return(OptionPrice-OptionPrice_cap);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

endsub;
